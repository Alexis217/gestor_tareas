# Define los "servidores upstream" (nuestros servicios de Docker)
upstream backend_service {
  # 'backend' es el nombre del servicio en docker-compose.yml
  # '3000' es el puerto donde corre la app Node
  server backend:3000;
}

server {
  # Nginx escuchará en el puerto 80 (HTTP)
  listen 80;

  # --- Ubicación 1: La API ---
  # Cualquier petición que empiece con /api/...
  location /api/ {
    # Elimina /api/ del path antes de pasarlo al backend
    # Ej: /api/tasks -> /tasks
    
    # Pasa la petición al servicio backend
    proxy_pass http://backend_service; 
    
    # Cabeceras estándar para un proxy reverso
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # --- Ubicación 2: El Frontend (Root) ---
  # Cualquier otra petición (/, /index.html, /style.css, etc.)
  location / {
    # Directorio raíz donde están los archivos estáticos
    # (Este path '/var/www/html' lo definiremos en docker-compose.yml)
    root /var/www/html; 
    
    # Intenta encontrar el archivo solicitado
    # Si no lo encuentra, devuelve /index.html (para Single Page Apps)
    try_files $uri $uri/ /index.html; 
  }
}